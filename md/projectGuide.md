## 프로젝트 이름

---

쇼핑몰 구축  [Notion Page](https://likelion.notion.site/e2d3194f025844d5a1fe895e5b26d890)

### 프로젝트 개요

---

일반 사용자는 중고거래가 가능하며, 사업자는 인터넷 쇼핑몰을 운영할 수 있게 해주는
쇼핑몰 사이트를 만들어보자.

요구사항의 내용은 프론트엔드 없이, 백엔드만 개발한다. 별도의 프론트엔드 클라이언트가 존재한다고 생각하고 서버를 만들고, Postman으로 테스트를 한다. 단, CORS는 지금은 고려하지 않는다.

## 기능 설명

---

### 1. 기본 과제

- 사용자 인증 및 권한 처리
- 중고거래 중개하기
- 쇼핑몰 운영하기

### 2. 추가 과제 (최소 1개 구현)

---

아래 요구사항 중 최소 2개를 개발한다.
단, “알림 기능 추가하기 - E-mail”과 “알림 기능 추가하기 - SMS” 는 **둘 중 하나만** 개발한다.

- 결제 시스템 (Toss Payments)
- 사용자 위치기반 기능 (NCP MAPS)
- 알림 기능 추가하기 - E-mail (Jakarta Mail)
- 알림 기능 추가하기 (NCP SENS)
- 사업자 자동 로그인 방지 (NCP Capcha)

## 기본 과제 요구사항

---

### 사용자 인증 및 권한 처리

- 요청을 보낸 사용자가 누구인지 구분할 수 있는 인증 체계가 갖춰져야 한다.
  - JWT 기반의 토큰 인증 방식이 권장된다.
  - 사용자는 별도의 클라이언트를 통해 아이디와 비밀번호를 전달한다.
  - 로그인 URL로 아이디와 비밀번호가 전달되면, 해당 내용의 정당성을 확인하여 JWT를 발급하여 클라이언트에게 반환한다.
  - 클라이언트는 이후 이 JWT를 Bearer Authentication 방식으로 제시해야 한다.
- 사용자는 회원가입이 가능하다.
  - 아이디, 비밀번호를 제공하여 회원가입이 가능하다.
  - 서비스를 이용하려면 닉네임, 이름, 연령대, 이메일, 전화번호 정보를 추가해야 한다.
  - 사용자의 프로필 이미지가 업로드 가능하다.
  - ~~광역자치단체 단위의 지역정보를 추가할 수 있다.~~
  - ~~네이버 아이디로 로그인, 카카오 아이디로 로그인이 가능하다.~~
    - ~~단, 소셜 로그인으로 받지 못한 정보는 추가적으로 요구할 수 있어야 한다.~~
- 사용자의 권한이 관리되어야 한다.
  - 네 종류의 사용자가 있다. (비활성 사용자, 일반 사용자, 사업자 사용자, 관리자)
  - 최초의 회원가입시 비활성 사용자로 가입된다.
  - 비활성 사용자가 서비스를 위한 필수 정보를 추가하면 일반 사용자로 자동으로 전환된다.
  - 일반 사용자는 자신의 사업자 등록번호(가정)을 전달해 사업자 사용자로 전환신청을 할 수 있다.
    - 사업자 등록번호는 실제 형식과 일치할 필요 없다.
  - 관리자는 사업자 사용자 전환 신청 목록을 확인할 수 있다.
  - 관리자는 사업자 사용자 전환 신청을 수락 또는 거절할 수 있다.
  - 관리자는 서비스와 상관없이 고정된 사용자이다.
    - 다른 회원가입 과정을 통해 만들어진 사용자는 관리자가 될 수 없다.

### 중고거래 중개하기

- 물품 등록
  - 일반 사용자는 중고 거래를 목적으로 물품에 대한 정보를 등록할 수 있다.
    - 제목, 설명, 대표 이미지, 최소 가격이 필요하다.
      - 대표 이미지는 반드시 함께 등록될 필요는 없다.
      - 다른 항목은 필수이다.
      - 최초로 물품이 등록될 때, 중고 물품의 상태는 **판매중** 상태가 된다.
  - 등록된 물품 정보는 비활성 사용자를 제외 누구든지 열람할 수 있다.
    - ~~등록자의 광역자치단체 단위의 지역 정보가 같이 기재된다.~~
    - 사용자의 상세 정보는 공개되지 않는다.
  - 등록된 물품 정보는 작성자가 수정, 삭제가 가능하다.
- 구매 제안
  - **물품을 등록한 사용자**와 **비활성 사용자** 제외, 등록된 물품에 대하여 구매 제안을 등록할 수 있다.
  - 등록된 구매 제안은 **물품을 등록한 사용자**와 **제안을 등록한 사용자**만 조회가 가능하다.
    - **제안을 등록한 사용자**는 자신의 제안만 확인이 가능하다.
    - **물품을 등록한 사용자**는 모든 제안이 확인 가능하다.
  - **물품을 등록한 사용자**는 ****등록된 구매 제안을 수락 또는 거절할 수 있다.
    - 이때 구매 제안의 상태는 **수락** 또는 **거절**이 된다.
  - **제안을 등록한 사용자**는 자신이 등록한 제안이 수락 상태일 경우, 구매 확정을 할 수 있다.
    - 이때 구매 제안의 상태는 **확정** 상태가 된다.
    - 구매 제안이 확정될 경우, 대상 물품의 상태는 **판매 완료**가 된다.
    - 구매 제안이 확정될 경우, 확정되지 않은 다른 구매 제안의 상태는 모두 **거절**이 된다.


### 쇼핑몰 운영하기

- 쇼핑몰 개설
  - 일반 사용자가 사업자 사용자로 전환될 때 **준비중** 상태의 쇼핑몰이 추가된다. 사업자 사용자는 이 쇼핑몰의 주인이 된다.
  - 쇼핑몰에는 이름, 소개, 분류의 정보를 가지고 있으며, 주인은 자유롭게 수정이 가능하다.
    - 분류의 종류는 서비스 제작자에 의해 미리 정해진다. (최소 5)
  - 쇼핑몰의 이름, 소개, 분류가 전부 작성된 상태라면 쇼핑몰을 개설 신청을 할 수 있다.
  - 관리자는 개설 신청된 쇼핑몰의 목록을 확인할 수 있으며, 정보를 확인후 허가 또는 불허 할 수 있다.
    - 불허 할 경우 그 이유를 함께 작성해야 한다.
    - 불허된 이유를 쇼핑몰의 주인이 확인할 수 있어야 한다.
  - 개설이 허가된 쇼핑몰을 **오픈** 상태가 된다.
  - 쇼핑몰 주인은 사유를 작성하여 쇼핑몰 폐쇄 요청을 할 수 있다.
    - 관리자는 쇼핑몰 폐쇄 요청을 확인 후 수락할 수 있다.

- 쇼핑몰 관리
  - 쇼핑몰 주인은 쇼핑몰에 상품을 등록할 수 있다.
    - 필수적인 정보는 상품 이름, 상품 이미지, 상품 설명, 상품 가격, ~~상품 분류, 상품 소분류,~~ 상품 재고가 있다.
    - ~~상품 분류와 소분류는 쇼핑몰의 주인이 추가하거나, 다른 쇼핑몰 주인이 추가했던 분류를 바탕으로 선택할 수 있다.~~
  - ~~관리자는 상품 분류 목록을 보고, 유사한 분류를 같은 분류가 될 수 있도록 분류를 수정할 수 있다.~~
    - ~~쇼핑몰 주인이 취해야 하는 추가적 행동은 없다.~~
  - 쇼핑몰 주인은 등록한 상품을 수정할 수 있다.
  - ~~쇼핑몰 주인은 등록한 상품의 할인을 진행할 수 있다.~~
    - ~~기한과 할인율을 바탕으로, 할인 가격이 자동으로 적용되도록 한다.~~
  - 쇼핑몰 주인은 등록한 상품을 삭제할 수 있다.

- 쇼핑몰 조회
  - 비활성 사용자를 제외한 사용자는 쇼핑몰을 조회할 수 있다.
    - 조건 없이 조회할 경우, 가장 최근에 거래가 있었던 쇼핑몰 순서로 조회된다.
    - 이름, 쇼핑몰 분류~~, 등록된 상품 분류, 등록된 상품 소분류~~를 조건으로 쇼핑몰을 검색할 수 있다. ~~단, 분류와 소분류는 하나만 선택이 가능하다.~~

- 쇼핑몰 상품 검색
  - 비활성 사용자를 제외한 사용자는 쇼핑몰의 상품을 검색할 수 있다.
    - 이름, ~~상품 분류, 상품 소분류,~~ 가격 범위를 기준으로 상품을 검색할 수 있다. ~~단, 분류와 소분류는 하나만 선택이 가능하다.~~
    - 조회되는 상품이 등록된 쇼핑몰에 대한 정보가 함께 제공되어야 한다.

- 쇼핑몰 상품 구매
  - 비활성 사용자를 제외한 사용자는 쇼핑몰의 상품을 구매할 수 있다.
    - 상품과 구매 수량을 기준으로 구매 요청을 할 수 있다.
    - 구매 요청 후 사용자는 구매에 필요한 금액을 전달한다고 가정한다.
    - 주인이 전달된 금액을 확인하면 구매 요청을 수락할 수 있다.
    - 구매 요청이 수락되면, 상품 재고가 자동으로 갱신된다. 이후엔 구매 취소가 불가능하다.
    - 구매 요청이 수락되기 전에는 구매 요청을 취소할 수 있다.

## 추가 과제 요구사항

---

### 결제 시스템 (Toss Payments)

---

사용자가 서비스 사용중 두가지 상황에서 결제를 진행하도록 서비스를 수정한다.

- 쇼핑몰 상품 구매
  - 사용자가 상품의 구매 요청을 하는 시점에, 결제를 진행한다.
  - 결제가 이뤄지면 자동으로 재고가 갱신된다.
  - 주인은 구매 요청에 대하여 구매 요청을 수락할 수 있다. 이후엔 구매 취소가 불가능하다.
  - 정당한 사유가 있으면 구매 요청을 거절할 수 있다. 사유는 관리자가 확인 가능하다.
  - 구매 요청이 수락되기 전에는 사용자가 구매 요청을 취소할 수 있다.
  - 구매 요청이 취소될 경우 사용자는 구매에 결제된 금액을 환불받는다.

- ~~중고거래 물품 구매 확정~~
  - ~~물품을 등록한 사용자가 구매를 수락하면, 구매 제안을 등록한 사용자는 구매 확정을 하기 위해 결제를 진행한다.~~
    - ~~결제된 돈은 위탁금의 개념으로, 물품을 등록한 사용자에게 바로 전송되지 않는다.~~
    - ~~결제가 정상적으로 이뤄질 때, 구매 제안의 상태는 **확정**이 된다. 물품의 상태는 판매 완료로 전환되지 않도록 수정한다.~~
  - ~~구매 제안을 한 사용자와 물품을 등록한 사용자는 이후 실제로 물품을 주고받는다.~~
    - ~~물품을 주고받은 뒤, 각 사용자는 일정 기간 안에 거래의 상태(완료, 실패)를 서비스에 알려야 한다.~~
    - ~~양쪽 사용자가 거래 완료를 서비스에 알리면, 물품의 상태가 판매 완료로 전환되며, 물품을 등록한 사용자는 위탁금을 전송받는다(실제로 전송받는 부분은 미구현)~~
    - ~~어느 한쪽 사용자가 완료를 하지 못한 상태의 구매 제안은 관리자가 확인할 수 있다.~~
      - ~~이때 오래된 구매 제안부터 확인이 된다.~~


### 사용자 위치기반 기능 (NCP Maps)

---

사용자 위치 기반 서비스를 추가한다.

- 중고 물품 구매 확정시
  - ~~물품을 등록한 사용자의 구매 수락 요청시의 IP주소를 바탕으로 사용자의 위치를 유추한다.~~
  - ~~구매 제안을 확정한 사용자의 확정 요청시의 IP주소를 바탕으로 사용자의 위치를 유추한다.~~
    - ~~이 정보를 바탕으로 서비스는 사용자에게 실제 거래를 진행할 만한 장소를 읍면동 단위로 추천한다.~~
    - ~~추천하는 기준은 자유이다.~~
  - 두 사용자는 거래를 진행할 위치를 제안할 수 있다.
    - 서로의 제안을 확인하고, 어느쪽 사용자든 상대방의 제안을 수락할 수 있다.
    - 수락하게 되면 각 사용자는 ~~구매 제안 정보~~를 바탕으로, 거래 위치까지 이동할 수 있는 방법에 대한 정보를 제공받을 수 있다.

- 오프라인 구매
  - 쇼핑몰에 오프라인 상점 위치를 등록할 수 있다.
  - 쇼핑몰의 상품을 구매할때 방문을 선택할 수 있다.
  - 사용자는 자신의 위치로부터 쇼핑몰까지 이동할 수 있는 방법에 대한 정보를 제공받을 수 있다.

### 알림 기능 추가하기 - E-mail (Jakarta Mail)

---

서비스의 특정 지점의 사용자에게 이메일로 서비스의 상태 변화를 알려준다.

이 기능 또는 SMS 기능은 둘 중 하나만 적용한다. [Jakarta Mail 패키지](https://docs.spring.io/spring-framework/reference/integration/email.html)를 이용한다.

- 회원가입 시 사용자 이메일 인증
  - 비활성 사용자가 이메일 주소를 기입할 때, 이메일 인증을 할 수 있도록 한다.
    - 비활성 사용자가 계정 활성화를 위해 필수 정보를 입력한다.
    - 본래의 요구사항대로 계정이 바로 활성화 되는 대신, 사용자의 이메일로
      이메일이 전송된다.
    - 전송된 이메일의 링크를 접속하면 사용자 계정이 활성화 된다.
    - 단, 이메일의 링크를 10분 이내에 클릭해야 한다. 시간이 지날 경우 다시 이메일 인증을
      요청할 수 있다.

- 중고 거래 시 구매 제안 알림
  - 사용자가 등록한 물품에 구매 제안이 등록될 경우 간략한 정보가 이메일로 전송된다.
    - 대상 물품, 제안 가격 등
  - 사용자가 등록한 구매 제안이 수락되면, 구매 제안을 한 사용자에게 정보가 이메일로
    전송된다.
  - 사용자가 등록한 물품의 거래가 종료되면, 확정되지 않은 사용자에게 정보가 이메일로
    전송된다.

- 상품 판매 확정 알림
  - 쇼핑몰의 상품에 대하여 구매요청을 한 사용자는, 주인이 구매를 확정하는 시점에 정보가
    이메일로 전송된다.


### 알림 기능 추가하기 - SMS (NCP SENS)

---

서비스의 특정 지점에 사용자에게 문자로 서비스의 상태 변화를 알려준다. 이 기능 또는 E-mail 기능은 둘 중 하나만 적용한다. [NCP SENS](https://www.ncloud.com/product/applicationService/sens) 서비스를 활용한다.

- 회원가입시 사용자 핸드폰 인증
  - 비활성 사용자가 핸드폰 번호를 기입할때, 핸드폰 인증을 할 수 있도록 한다.
    - 비활성 사용자가 계정 활성화를 위해 필수 정보를 입력한다.
    - 본래의 요구사항데로 계정이 바로 활성화 되는 대신, 사용자의 핸드폰으로 문자 메시지를 통해 인증번호가 전송된다.
    - 사용자는 특정 UI를 통해 전달된 인증번호를 전달한다. 인증번호가 보내진 인증번호와 일치하면 사용자의 계정이 활성화된다.
    - 단 인증 번호를 3분 이내에 전달해야 한다. 시간이 지날경우 다시 번호 인증을 요청할 수 있다.

- 중고 거래시 구매 제안 알림
  - 사용자가 등록한 물품에 구매 제안이 등록될 경우 간략한 정보가 문자로 전송된다.
    - 대상 물품, 제안 가격 등
  - 사용자가 등록한 구매 제안이 수락되면, 구매 제안을 한 사용자에게 정보가 문자로 전송된다.
  - 사용자가 등록한 물품의 거래가 종료되면, 확정되지 않은 사용자에게 정보가 문자로 전송된다.

- 상품 판매 확정 알림
  - 쇼핑몰의 상품에 대하여 구매요청을 한 사용자는, 주인이 구매를 확정하는 시점에 정보가 문자로 전송된다.

### 사업자 자동 로그인 방지 (NCP Capcha)

---

사업자 사용자 또는 관리자의 자동 로그인을 방지한다.

- 로그인 시도
  - 사업자 또는 관리자가 로그인을 시도하면, 캡차 사진을 볼 수 있는 링크로 이동시킨다.
  - 캡차에 나타나는 글씨를 정상적으로 입력하면, 로그인을 진행한다.
  - 사용자가 로그인을 위해 아이디 비밀번호를 제공한 시점과 캡차가 제공되는 시점이 다르다.
    - 상태를 구분하기 위한 대책을 마련해야 한다.